ARG BASE_IMAGE=kairon-base:latest
FROM $BASE_IMAGE

WORKDIR ${KAIRON_HOME}

ENV APP_MODULE=kairon.api.app.main:app TEMPLATE_DIR_DEFAULT=./template/use-cases/Hi-Hello-GPT RASA_TELEMETRY_ENABLED=false
EXPOSE 80


RUN rm -rf ${TEMPLATE_DIR_DEFAULT}/models/* && \
    rasa train --data ${TEMPLATE_DIR_DEFAULT}/data --config ${TEMPLATE_DIR_DEFAULT}/config.yml --domain ${TEMPLATE_DIR_DEFAULT}/domain.yml --out ${TEMPLATE_DIR_DEFAULT}/models


CMD uvicorn ${APP_MODULE} --host 0.0.0.0 --port 80 --no-server-header --no-access-log
