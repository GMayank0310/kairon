ARG BASE_IMAGE=kairon-base:latest
FROM $BASE_IMAGE

WORKDIR ${KAIRON_HOME}

ENV APP_MODULE=kairon.chat.server:main TIMEOUT=120 LOG_LEVEL_LIBRARIES=ERROR WEB_CONCURRENCY=1

RUN cp kairon/shared/rule_policy.py /usr/local/lib/python3.10/site-packages/rasa/core/policies/rule_policy.py

RUN python -m pip install granian

EXPOSE 5000
CMD granian ${APP_MODULE} --host 0.0.0.0 --port 5000 --threads ${WEB_CONCURRENCY} --interface asgi --log-level error

